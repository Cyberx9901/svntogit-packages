# Maintainer: Tobias Powalowski <tpowa@archlinux.org>

pkgname=(archboot-linux-firmware)
pkgver=20210919.d526e04
pkgrel=1
pkgdesc="Firmware files for archboot creation"
url="https://git.kernel.org/?p=linux/kernel/git/firmware/linux-firmware.git;a=summary"
license=('GPL2' 'GPL3' 'custom')
arch=('any')
makedepends=('linux-firmware' 'kmod' 'linux')
conflicts=('linux-firmware')
options=(!strip)

package() {
  cd /lib/modules/*
  # get firmware files from modules
  for i in $(find -name '*.ko.zst');do
    FIRMWARE="$FIRMWARE $(echo $(modinfo -F firmware $(pwd)/$i))"
  done
  for i in $(echo $FIRMWARE);do
  [[ -e /lib/firmware/$i ]] && cp -ar --parents /lib/firmware/$i ${pkgdir}
  done
}
# vim:set sw=2 et:
